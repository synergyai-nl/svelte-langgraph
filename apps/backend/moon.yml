# https://moonrepo.dev/docs/config/project
$schema: "https://moonrepo.dev/schemas/project.json"

language: python
stack: backend
type: application

tasks:
  format:
    command: "ruff format"
    args: "--check"
  format-write:
    command: "ruff format"
    local: true
  lint:
    command: "ruff check"
  lint-fix:
    extends: lint
    args: "--fix"
    local: true
  typecheck:
    command: "pyright"
  test:
    command: "pytest"
    args: "-v"
  oidc-mock:
    command: "oidc-provider-mock --port 8080 --host 127.0.0.1 --user test-user"
    preset: "server"
    local: true
  dev:
    command: "langgraph dev --no-browser"
    preset: "watcher"
    deps:
      - oidc-mock
  build:
    command: "langgraph build --tag svelte-langgraph-backend --pull"
    deps:
      - lint
      - typecheck
  up:
    command: "langgraph up"
    preset: "server"
    deps:
      - build
