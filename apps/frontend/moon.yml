$schema: 'https://moonrepo.dev/schemas/project.json'

language: typescript
stack: frontend
type: application

fileGroups:
  sources:
    - 'src/**/*'
    # Configs
    - '**/*.config.*'
    # Other files
    - '**/*.{md,mdx,yml,yaml,json}'
  tests:
    - 'tests/**/*'
    - 'e2e/**/*'
  messages:
    - 'project.inlang'
    - 'messages'

tags: ['vite', 'vitest', 'sveltekit', 'prettier']

tasks:
  build:
    inputs:
      - '@group(sources)'
      - '@group(messages)'
    outputs:
      - 'build'
      - 'src/lib/paraglide'
    options:
      retryCount: 1

  check:
    deps:
      - build

  lint:
    command: eslint .
    inputs:
      - '@group(messages)'
      - '@group(sources)'
      - '@group(tests)'
      # Root configs, any format
      # - '/eslint.config.js'

  lint-fix:
    extends: lint
    args:
      - '--cache'
      - '--fix'
    local: true

  format:
    inputs:
      - '@group(messages)'
      - '@group(tests)'

  test:
    args:
      - '--silent'
      - 'passed-only'

  test-cov:
    args:
      - '--coverage.reporter text --coverage.reporter lcov'
      - '--coverage.include src'
      - '--coverage.exclude "**/*.(test|spec).*" --coverage.exclude src/lib/paraglide'

  dev:
    options:
      envFile: '/.env'

  serve-e2e:
    extends: preview
    options:
      envFile: '/.env.e2e'
