type: 'application'
language: 'typescript'
platform: 'node'
stack: 'frontend'

tags: ['sveltekit', 'vite', 'vitest']

tasks:
  dev:
    command: 'vite dev'
    inputs:
      - 'src/**/*'
      - 'package.json'
      - 'vite.config.ts'
      - 'svelte.config.js'
      - 'tsconfig.json'
    local: true

  build:
    command: 'vite build'
    inputs:
      - 'src/**/*'
      - 'package.json'
      - 'vite.config.ts'
      - 'svelte.config.js'
      - 'tsconfig.json'
    outputs:
      - 'build'
      - '.svelte-kit'

  preview:
    command: 'vite preview'
    deps:
      - 'build'

  check:
    command: 'svelte-kit sync && svelte-check --tsconfig ./tsconfig.json'
    inputs:
      - 'src/**/*'
      - 'tsconfig.json'
      - 'svelte.config.js'

  lint:
    command: 'prettier --check . && eslint .'
    inputs:
      - 'src/**/*'
      - 'eslint.config.js'
      - 'package.json'

  format:
    command: 'prettier --write .'
    inputs:
      - 'src/**/*'
      - 'package.json'

  test:
    deps:
      - 'test-unit'
      - 'test-e2e'

  test-unit:
    command:
      - 'vitest'
      - 'run'
      # Dont fail if a project has no tests
      - '--passWithNoTests'
    inputs:
      - 'src/**/*'
      - 'package.json'
      - 'vitest-setup-client.ts'

  test-e2e:
    command: 'playwright test'
    inputs:
      - 'src/**/*'
      - 'e2e/**/*'
      - 'playwright.config.ts'
